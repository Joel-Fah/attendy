{% extends 'core/base_app.html' %}
{% load static %}
{% load tailwind_tags %}
{% load custom_date_formatter duration_formatter %}

{# Title of the page #}
{% block title %} {{ course.title }} {% endblock %}

{% block extra_styles %}
{% endblock extra_styles %}

{# Body styles #}
{% block body_styles %}
{% endblock body_styles %}

{# Header of the page #}
{% block header %}
{% include "components/header_app.html" %}
{% endblock header %}

{# Body of the page #}
{% block body %}
<div class="relative p-4 md:ml-64">
    <div class="flex flex-col gap-4 items-start justify-center w-full mt-14">
        <div class="flex flex-col gap-2">
            <small>
                <a href="{% url 'core:courses' %}" class="text-secondaryColor">Courses</a> /
            </small>
            <h2 class="text-3xl">
                {{ course.code }} {{ course.title }}
            </h2>
            <div class="flex items-center gap-2">
                <small class="text-darkColor flex gap-1 px-2.5 rounded-xl bg-darkColor/5 w-">
                    <span class="text-darkColor/50">Done on: </span>
                    {{ course.date|format_date }}
                </small>

                {% if course.is_catchup %}
                <small class="text-danger flex gap-1 px-2.5 rounded-xl bg-danger/5 w-">
                    catchup class
                </small>
                {% endif %}
            </div>
        </div>

        <div class="w-full grid grid-cols-12 gap-2">
            <div class="col-span-7 flex flex-col gap-2">
                <div class="relative right-0">
                    <ul class="relative flex flex-wrap p-1 list-none rounded-xl bg-blue-gray-50/60" data-tabs="tabs"
                        role="list">
                        <li class="z-30 w-auto px-2 rounded-xl text-center">
                            <a class="z-30 flex items-center justify-center w-full px-0 py-1 mb-0 transition-all ease-in-out border-0 rounded-lg cursor-pointer bg-inherit"
                                data-tab-target="" active="" role="tab" aria-selected="true" aria-controls="app">
                                <span class="ml-1 flex items-center gap-2">
                                    Course overview
                                </span>
                            </a>
                        </li>
                        <li class="z-30 w-auto px-2 rounded-xl text-center">
                            <a class="z-30 flex items-center justify-center w-full px-0 py-1 mb-0 transition-all ease-in-out border-0 rounded-lg cursor-pointer bg-inherit"
                                data-tab-target="" role="tab" aria-selected="false" aria-controls="message">
                                <span class="ml-1 flex items-center gap-2">
                                    Enrolled students
                                    <span class="text-sm bg-darkColor/10 px-2.5 py-0.5 rounded-xl"> {{ enrolled_students.count }}
                                    </span>
                                </span>
                            </a>
                        </li>
                    </ul>
    
                    <div data-tab-content="" class="p-2">
                        <div class="block opacity-100" id="app" role="tabpanel">
                            <ul class="space-y-4">
                                <li class="">
                                    <div class="flex items-center justify-between">
                                        <p class="text-darkColor/50">Code:</p>
                                        <p class="text-darkColor">{{ course.code }}</p>
                                    </div>
                                </li>
                                <hr class="border-darkColor/10">
                                <li class="">
                                    <div class="flex items-center justify-between">
                                        <p class="text-darkColor/50">Title:</p>
                                        <p class="text-darkColor">{{ course.title }}</p>
                                    </div>
                                </li>
                                <hr class="border-darkColor/10">
                                <li class="">
                                    <div class="flex items-center justify-between">
                                        <p class="text-darkColor/50">Start time:</p>
                                        <p class="text-darkColor">{{ course.start_time }}</p>
                                    </div>
                                </li>
                                <hr class="border-darkColor/10">
                                <li class="">
                                    <div class="flex items-center justify-between">
                                        <p class="text-darkColor/50">End time:</p>
                                        <p class="text-darkColor">{{ course.end_time }}</p>
                                    </div>
                                </li>
                                <hr class="border-darkColor/10">
                                <li class="">
                                    <div class="flex items-center justify-between">
                                        <p class="text-darkColor/50">Duration:</p>
                                        <p class="text-darkColor">{{ course.duration|format_duration }}</p>
                                    </div>
                                </li>
                                <hr class="border-darkColor/10">
                                <li class="">
                                    <div class="flex items-center justify-between">
                                        <p class="text-darkColor/50">Semester:</p>
                                        <p class="text-darkColor">{{ course.semester }} {{ course.year}}</p>
                                    </div>
                                </li>
                            </ul>
                        </div>
    
                        <div class="hidden opacity-0" id="message" role="tabpanel">
                            <ul class="space-y-2">
                                {% for enrollment in enrolled_students %}
                                <li>
                                    <div
                                        class="flex items-center justify-between px-4 py-2 transition-all duration-300 ease-linear hover:bg-secondaryColor/5">
                                        <div class="flex items-center gap-4">
                                            <span> {{ forloop.counter }}. </span>
                                            <div class="flex flex-col gap-0.5">
                                                {{ enrollment.student.name }}
                                                <small class="text-sm text-darkColor/50">
                                                    {{ enrollment.student.email }} | {{ enrollment.student.department }} | {{ enrollment.student.phone }}
                                                </small>
                                            </div>
                                        </div>
                                        {% if enrollment.student.is_delegate %}
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"
                                            fill="none" class="text-secondaryColor">
                                            <path
                                                d="M13.7276 3.44418L15.4874 6.99288C15.7274 7.48687 16.3673 7.9607 16.9073 8.05143L20.0969 8.58575C22.1367 8.92853 22.6167 10.4206 21.1468 11.8925L18.6671 14.3927C18.2471 14.8161 18.0172 15.6327 18.1471 16.2175L18.8571 19.3125C19.417 21.7623 18.1271 22.71 15.9774 21.4296L12.9877 19.6452C12.4478 19.3226 11.5579 19.3226 11.0079 19.6452L8.01827 21.4296C5.8785 22.71 4.57865 21.7522 5.13859 19.3125L5.84851 16.2175C5.97849 15.6327 5.74852 14.8161 5.32856 14.3927L2.84884 11.8925C1.389 10.4206 1.85895 8.92853 3.89872 8.58575L7.08837 8.05143C7.61831 7.9607 8.25824 7.48687 8.49821 6.99288L10.258 3.44418C11.2179 1.51861 12.7777 1.51861 13.7276 3.44418Z"
                                                stroke="currentColor" stroke-width="1.5" stroke-linecap="round"
                                                stroke-linejoin="round" />
                                        </svg>
                                        {% endif %}
                                    </div>
                                </li>
                                {% empty %}
                                <p class="px-4 py-2 text-disabledColor">No students enrolled in this course.</p>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class=" flex flex-col gap-6 col-start-9 col-span-3">
                <h3 class="">Intervenants</h3>
                
                <div class="flex flex-col gap-2">
                    <div class="flex flex-col items-start bg-darkColor/5 rounded-2xl px-4 py-1.5 wma">
                        <small class="text-darkColor/50">Lecturer</small>
                        {% if course.lecturer %}
                        <p class="text-darkColor">{{ course.lecturer }}</p>
                        {% else %}
                        <p class="text-danger"> No lecturer </p>
                        {% endif %}
                    </div>

                    <div class="flex flex-col items-start bg-darkColor/5 rounded-2xl px-4 py-1.5 wma">
                        <small class="text-darkColor/50">Course delegate(s)</small>
                        {% for enrollment in enrolled_students %}
                            {% if enrollment.student.is_delegate %}
                                <p class="text-darkColor block">{{ enrollment.student.name }}</p>
                            {% endif %}
                            {% empty %}
                            <p class="text-danger block"> No course delegate(s) </p>
                        {% endfor %}
                    </div>

                    <small class="mt-5 px-2">
                        You are viewing this course as it was lastly edited on 
                        <span class="text-secondaryColor">
                            {{ course.updated_at|format_date }}
                        </span> 
                    </small>
                </div>
            </div>
        </div>

    </div>
</div>
{% endblock body %}

{# Additional javascript #}
{% block javascript %}
<!-- from cdn -->
<script src="{% static 'core/js/tabs.js' %}"></script>
{% endblock javascript %}